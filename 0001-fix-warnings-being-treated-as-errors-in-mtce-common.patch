From 74b3482a5ea1e62ed3076ecfde3b90c5795a384a Mon Sep 17 00:00:00 2001
From: yhu6 <yong.hu@intel.com>
Date: Mon, 1 Oct 2018 10:49:48 +0800
Subject: [PATCH] fix warnings being treated as errors in mtce-common

---
 mtce-common/src/common/httpUtil.cpp     | 2 +-
 mtce-common/src/common/msgClass.cpp     | 4 ++--
 mtce-common/src/common/nodeUtil.cpp     | 2 +-
 mtce-common/src/daemon/daemon_files.cpp | 4 ++--
 mtce-common/src/daemon/daemon_ini.cpp   | 2 +-
 5 files changed, 7 insertions(+), 7 deletions(-)

diff --git a/mtce-common/src/common/httpUtil.cpp b/mtce-common/src/common/httpUtil.cpp
index 469d945..9b755b6 100644
--- a/mtce-common/src/common/httpUtil.cpp
+++ b/mtce-common/src/common/httpUtil.cpp
@@ -762,7 +762,7 @@ int httpUtil_api_request ( libEvent & event )
         ;
     }
 
-    else if ( TEST_WITH_NO_TOKEN )
+    else if ( event.request == TEST_WITH_NO_TOKEN )
     {
         ;
     }
diff --git a/mtce-common/src/common/msgClass.cpp b/mtce-common/src/common/msgClass.cpp
index 6e876e5..5ef4f18 100644
--- a/mtce-common/src/common/msgClass.cpp
+++ b/mtce-common/src/common/msgClass.cpp
@@ -309,8 +309,8 @@ int msgClassAddr::getAddressFromInterface(const char* interface, char* address,
     // if it is infra then we need to determine the interface
     // host name. For management interface, the system hostname
     // is the intf hostname
-    char iface_hostname[MAX_HOST_NAME_SIZE+1] = {0};
-    snprintf(iface_hostname, MAX_HOST_NAME_SIZE,
+    char iface_hostname[MAX_HOST_NAME_SIZE+6+1] = {0};
+    snprintf(iface_hostname, sizeof(iface_hostname),
              "%s%s", hostname,
              (((interface_type == INFRA_IFACE)) ? "-infra" : ""));
 
diff --git a/mtce-common/src/common/nodeUtil.cpp b/mtce-common/src/common/nodeUtil.cpp
index 73a7569..d39e1ad 100755
--- a/mtce-common/src/common/nodeUtil.cpp
+++ b/mtce-common/src/common/nodeUtil.cpp
@@ -676,7 +676,7 @@ string get_iface_mac ( const char * iface_ptr )
         char str [COL_CHARS_IN_MAC_ADDR+1] ; /* and terminator */
         memset  ( &str[0], 0 , COL_CHARS_IN_MAC_ADDR);
 
-        snprintf ( &str[0], COL_CHARS_IN_MAC_ADDR,
+        snprintf ( &str[0], COL_CHARS_IN_MAC_ADDR+1,
                   "%02x:%02x:%02x:%02x:%02x:%02x",
                (unsigned char)(s.ifr_hwaddr.sa_data[0]),
                (unsigned char)(s.ifr_hwaddr.sa_data[1]),
diff --git a/mtce-common/src/daemon/daemon_files.cpp b/mtce-common/src/daemon/daemon_files.cpp
index 8f2578f..1dbe8f7 100755
--- a/mtce-common/src/daemon/daemon_files.cpp
+++ b/mtce-common/src/daemon/daemon_files.cpp
@@ -777,7 +777,7 @@ string get_shadow_signature ( char * shadowfile , const char * username,
                     continue;
                 }
 
-                char shadowEntry[BUFFER] = {0};
+                char shadowEntry[BUFFER*2+2] = {0};
                 snprintf (shadowEntry, sizeof(shadowEntry), 
                           "%s:%s", password, aging);
 
@@ -930,7 +930,7 @@ void daemon_rename_file ( const char * path, const char * old_filename, const ch
 
 void daemon_remove_pidfile ( void )
 {
-    char str [64] ;
+    char str [MAX_FILENAME_LEN+8] ;
     sprintf (str, "rm -f %s", pid_filename );
     int rc = system (str);
     if ( rc )
diff --git a/mtce-common/src/daemon/daemon_ini.cpp b/mtce-common/src/daemon/daemon_ini.cpp
index e031b5d..a810ab8 100755
--- a/mtce-common/src/daemon/daemon_ini.cpp
+++ b/mtce-common/src/daemon/daemon_ini.cpp
@@ -56,7 +56,7 @@ static char* find_char_or_comment(const char* s, char c)
 /* Version of strncpy that ensures dest (size bytes) is null-terminated. */
 static char* strncpy0(char* dest, const char* src, size_t size)
 {
-    strncpy(dest, src, size);
+    strncpy(dest, src, size-1);
     dest[size - 1] = '\0';
     return dest;
 }
-- 
2.19.0

